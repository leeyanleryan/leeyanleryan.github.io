<div class="lt-toggle-buttons-jp no-double-tap-zoom">
  <div id="lt-toggle-original" class="lt-toggle-button">Toggle Original</div>
  <div id="lt-toggle-romanized" class="lt-toggle-button">Toggle Romanized</div>
  <div id="lt-toggle-english" class="lt-toggle-button">Toggle English</div>
</div>
<div class="lyrics-translations">
  {% assign lang_lines        = include.lyrics.lang        %}
  {% assign original_lines    = include.lyrics.original    %}
  {% assign romanized_lines   = include.lyrics.romanized   %}
  {% assign english_lines     = include.lyrics.english     %}
  {% assign explanation_lines = include.lyrics.explanation %}
  {% for orig in original_lines %}
    {% assign i = forloop.index0 %}
    {% assign lang = lang_lines[i] %}
    {% assign orig = original_lines[i] %}
    {% assign roma = romanized_lines[i] %}
    {% assign eng  = english_lines[i] %}
    {% assign expl = explanation_lines[i] %}
    {% if lang == "[[divider]]" %}
      <h5 class="h5-margin-0">-----------------------------------<br></h5>
    {% else %}
      {% if lang == "jp" %}
        <div class="lyrics-stanza" data-idx="{{ i }}">
          <h5>
            <span class="lt-original-text">{{ orig }}<br></span>
            <span class="lt-romanized-text"><em>{{ roma }}</em><br></span>
            <span class="lt-english-text">{{ eng }}<br></span>
          </h5>
        </div>
      {% elsif lang == "en" %}
        <div class="lyrics-stanza-none">
          <h5><span class="lt-english-text-only">{{ eng }}<br></span></h5>
        </div>
      {% endif %}
      
      {%- comment -%} parse the comma-delimited “text|lang|sense” row {%- endcomment -%}
      <div class="w3-row lyrics-explanation" id="exp-{{ i }}">
        {% if lang == "jp" and expl != "<empty>" %}
          <h6 class="w3-col s4 m4 h6-margin-0">Original</h6>
          <h6 class="w3-col s4 m4 h6-margin-0">Romanized</h6>
          <h6 class="w3-col s4 m4 h6-margin-0">English</h6>
          <hr class="hr-lyrics-explanation">

          {% assign cells = expl | split: "," %}
          {% for cell in cells %}
            {% assign parts = cell | split: "|" %}
            {% assign txt       = parts[0] %}
            {% assign sense_key = parts[2] | default: "" %}
            {% assign entry     = site.data.word-bank-jp[txt] %}

            {% if entry.senses %}
              {% if sense_key != "" %}
                {% assign sk = sense_key %}
              {% else %}
                {% assign sk = entry.senses | first | first %}
              {% endif %}
              {% assign gloss = entry.senses[sk].english %}
            {% else %}
              {% assign gloss = entry.english %}
            {% endif %}

            <h6 class="w3-col s4">
              {{ entry.kanji | default: entry.katakana | default: "-" }}
            </h6>
            <h6 class="w3-col s4"><em>{{ entry.romaji | default: "-" }}</em></h6>
            <h6 class="w3-col s4">{{ gloss | default: "-" }}</h6>
          {% endfor %}
        {% endif %}
      </div>
    {% endif %}
  {% endfor %}
</div>